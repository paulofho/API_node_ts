{"version":3,"file":"json-to-oas.js","sources":["../../src/json-to-oas.ts"],"sourcesContent":["import type { OpenAPIV3, OpenAPIV3_1 } from 'openapi-types'\nimport type { JSONSchema } from 'zod/v4/core'\n\ntype OASVersion = '3.0' | '3.1'\n\nexport const getOASVersion = (documentObject: {\n  openapiObject: Partial<OpenAPIV3.Document | OpenAPIV3_1.Document>\n}): OASVersion => {\n  const openapiVersion = documentObject.openapiObject.openapi || '3.0.3'\n\n  if (openapiVersion.startsWith('3.1')) {\n    return '3.1'\n  }\n\n  if (openapiVersion.startsWith('3.0')) {\n    return '3.0'\n  }\n\n  throw new Error('Unsupported OpenAPI document object')\n}\n\nexport const jsonSchemaToOAS_3_0 = (jsonSchema: JSONSchema.BaseSchema): OpenAPIV3.SchemaObject => {\n  const clone: any = { ...jsonSchema }\n\n  if (clone.type === 'null') {\n    clone.nullable = true\n    delete clone.type\n    clone.enum = [null]\n  }\n\n  if (Array.isArray(clone.prefixItems)) {\n    const tuple = clone.prefixItems as JSONSchema.BaseSchema[]\n\n    clone.minItems ??= tuple.length\n    clone.maxItems ??= tuple.length\n\n    clone.items = {\n      oneOf: tuple.map(jsonSchemaToOAS_3_0),\n    }\n\n    delete clone.prefixItems\n  }\n\n  if ('const' in clone && clone.const !== undefined) {\n    clone.enum = [clone.const]\n    delete clone.const\n  }\n\n  if (typeof clone.exclusiveMinimum === 'number') {\n    clone.minimum = clone.exclusiveMinimum\n    clone.exclusiveMinimum = true\n  }\n  if (typeof clone.exclusiveMaximum === 'number') {\n    clone.maximum = clone.exclusiveMaximum\n    clone.exclusiveMaximum = true\n  }\n\n  for (const key of [\n    '$schema',\n    '$id',\n    'unevaluatedProperties',\n    'dependentSchemas',\n    'patternProperties',\n    'propertyNames',\n    'contentEncoding',\n    'contentMediaType',\n  ]) {\n    delete clone[key]\n  }\n\n  const recursive = (v: any): any =>\n    Array.isArray(v) ? v.map(jsonSchemaToOAS_3_0) : jsonSchemaToOAS_3_0(v)\n\n  if (clone.properties) {\n    for (const [k, v] of Object.entries(clone.properties)) {\n      clone.properties![k] = jsonSchemaToOAS_3_0(v as any)\n    }\n  }\n\n  if (clone.items && !Array.isArray(clone.items)) {\n    clone.items = recursive(clone.items)\n  }\n\n  for (const key of ['allOf', 'anyOf', 'oneOf', 'not', 'then', 'else', 'if', 'contains']) {\n    if (clone[key]) {\n      clone[key] = recursive(clone[key])\n    }\n  }\n\n  return clone as OpenAPIV3.SchemaObject\n}\n\nconst jsonSchemaToOAS_3_1 = (jsonSchema: JSONSchema.BaseSchema): OpenAPIV3_1.SchemaObject => {\n  return jsonSchema as OpenAPIV3_1.SchemaObject\n}\n\nexport const jsonSchemaToOAS = (\n  jsonSchema: JSONSchema.BaseSchema,\n  oasVersion: OASVersion,\n): OpenAPIV3.SchemaObject | OpenAPIV3_1.SchemaObject => {\n  switch (oasVersion) {\n    case '3.0':\n      return jsonSchemaToOAS_3_0(jsonSchema)\n    case '3.1':\n      return jsonSchemaToOAS_3_1(jsonSchema)\n    default:\n      throw new Error(`Unsupported OpenAPI version: ${oasVersion}`)\n  }\n}\n"],"names":[],"mappings":"AAKO,MAAM,gBAAgB,CAAC,mBAEZ;AAChB,QAAM,iBAAiB,eAAe,cAAc,WAAW;AAE/D,MAAI,eAAe,WAAW,KAAK,GAAG;AACpC,WAAO;AAAA,EACT;AAEA,MAAI,eAAe,WAAW,KAAK,GAAG;AACpC,WAAO;AAAA,EACT;AAEA,QAAM,IAAI,MAAM,qCAAqC;AACvD;AAEO,MAAM,sBAAsB,CAAC,eAA8D;AAChG,QAAM,QAAa,EAAE,GAAG,WAAA;AAExB,MAAI,MAAM,SAAS,QAAQ;AACzB,UAAM,WAAW;AACjB,WAAO,MAAM;AACb,UAAM,OAAO,CAAC,IAAI;AAAA,EACpB;AAEA,MAAI,MAAM,QAAQ,MAAM,WAAW,GAAG;AACpC,UAAM,QAAQ,MAAM;AAEpB,UAAM,aAAa,MAAM;AACzB,UAAM,aAAa,MAAM;AAEzB,UAAM,QAAQ;AAAA,MACZ,OAAO,MAAM,IAAI,mBAAmB;AAAA,IAAA;AAGtC,WAAO,MAAM;AAAA,EACf;AAEA,MAAI,WAAW,SAAS,MAAM,UAAU,QAAW;AACjD,UAAM,OAAO,CAAC,MAAM,KAAK;AACzB,WAAO,MAAM;AAAA,EACf;AAEA,MAAI,OAAO,MAAM,qBAAqB,UAAU;AAC9C,UAAM,UAAU,MAAM;AACtB,UAAM,mBAAmB;AAAA,EAC3B;AACA,MAAI,OAAO,MAAM,qBAAqB,UAAU;AAC9C,UAAM,UAAU,MAAM;AACtB,UAAM,mBAAmB;AAAA,EAC3B;AAEA,aAAW,OAAO;AAAA,IAChB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA,GACC;AACD,WAAO,MAAM,GAAG;AAAA,EAClB;AAEA,QAAM,YAAY,CAAC,MACjB,MAAM,QAAQ,CAAC,IAAI,EAAE,IAAI,mBAAmB,IAAI,oBAAoB,CAAC;AAEvE,MAAI,MAAM,YAAY;AACpB,eAAW,CAAC,GAAG,CAAC,KAAK,OAAO,QAAQ,MAAM,UAAU,GAAG;AACrD,YAAM,WAAY,CAAC,IAAI,oBAAoB,CAAQ;AAAA,IACrD;AAAA,EACF;AAEA,MAAI,MAAM,SAAS,CAAC,MAAM,QAAQ,MAAM,KAAK,GAAG;AAC9C,UAAM,QAAQ,UAAU,MAAM,KAAK;AAAA,EACrC;AAEA,aAAW,OAAO,CAAC,SAAS,SAAS,SAAS,OAAO,QAAQ,QAAQ,MAAM,UAAU,GAAG;AACtF,QAAI,MAAM,GAAG,GAAG;AACd,YAAM,GAAG,IAAI,UAAU,MAAM,GAAG,CAAC;AAAA,IACnC;AAAA,EACF;AAEA,SAAO;AACT;AAEA,MAAM,sBAAsB,CAAC,eAAgE;AAC3F,SAAO;AACT;AAEO,MAAM,kBAAkB,CAC7B,YACA,eACsD;AACtD,UAAQ,YAAA;AAAA,IACN,KAAK;AACH,aAAO,oBAAoB,UAAU;AAAA,IACvC,KAAK;AACH,aAAO,oBAAoB,UAAU;AAAA,IACvC;AACE,YAAM,IAAI,MAAM,gCAAgC,UAAU,EAAE;AAAA,EAAA;AAElE;"}